<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Government Budget Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
    }
    .container {
      max-width: 800px;
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    .connect-btn {
      background-color: #34495e;
      color: white;
    }
    .allocate-btn {
      background-color: #27ae60;
      color: white;
    }
    .spend-btn {
      background-color: #2980b9;
      color: white;
    }
    .status-btn {
      background-color: #16a085;
      color: white;
    }
    .status {
      margin-top: 10px;
      background: #ecf0f1;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<header>
  <h1>üèõÔ∏è Government Budget Tracker</h1>
  <p>Transparent blockchain-based budget management system</p>
</header>

<div class="container">
  <button class="connect-btn" onclick="connectWallet()">Connect Wallet</button>
  <p id="walletAddress">Not connected</p>

  <h2>üí∞ Allocate Budget</h2>
  <label>Department ID:</label>
  <input id="allocDeptId" placeholder="e.g., dep1"/>
  <label>Budget Amount (ETH):</label>
  <input id="allocAmount" placeholder="e.g., 0.005"/>
  <label>Wallet Address:</label>
  <input id="allocWallet" placeholder="0x..." />
  <button class="allocate-btn" onclick="allocateBudget()">Allocate Budget</button>

  <h2>üí≥ Spend Budget</h2>
  <label>Department ID:</label>
  <input id="spendDeptId" placeholder="e.g., dep1"/>
  <label>Spend Amount (ETH):</label>
  <input id="spendAmount" placeholder="e.g., 0.001"/>
  <button class="spend-btn" onclick="spendBudget()">Spend Budget</button>

  <h2>üìù Check Department Status</h2>
  <label>Department ID:</label>
  <input id="statusDeptId" placeholder="e.g., dep1"/>
  <button class="status-btn" onclick="getStatus()">Get Status</button>
  <div class="status" id="deptStatus"></div>
</div>

<script>
  let web3;
  let contract;
  const contractAddress = "0x882e81b3278BAfcF446DfA24a3A8577b07fB7dE9"; // Replace with your Remix deployed address
  const abi =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "allocateBudget",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "remainingAmount",
				"type": "uint256"
			}
		],
		"name": "AuditPerformed",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "BudgetAllocated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "FundsSpent",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "spendFunds",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			}
		],
		"name": "auditBudget",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "remaining",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "budgets",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "allocatedAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "spentAmount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]; 

  async function connectWallet() {
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: "eth_requestAccounts" });
      const accounts = await web3.eth.getAccounts();
      document.getElementById("walletAddress").innerText = "Connected: " + accounts[0];
      contract = new web3.eth.Contract(abi, contractAddress);
    } else {
      alert("MetaMask not found. Please install it.");
    }
  }

  async function allocateBudget() {
    const deptId = document.getElementById("allocDeptId").value;
    const amount = document.getElementById("allocAmount").value;
    const wallet = document.getElementById("allocWallet").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.allocateBudget(deptId, wallet).send({
      from: accounts[0],
      value: web3.utils.toWei(amount, "ether")
    });

    alert("Budget allocated successfully.");
  }

  async function spendBudget() {
    const deptId = document.getElementById("spendDeptId").value;
    const amount = document.getElementById("spendAmount").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.spendBudget(deptId, web3.utils.toWei(amount, "ether")).send({
      from: accounts[0]
    });

    alert("Budget spent successfully.");
  }

  async function getStatus() {
    const deptId = document.getElementById("statusDeptId").value;
    const status = await contract.methods.getSpentAmount(deptId).call();
    document.getElementById("deptStatus").innerText = `Spent: ${web3.utils.fromWei(status, "ether")} ETH`;
  }
</script>

</body>
</html>
