<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gov Budget Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f5f7fa;
    }
    .navbar {
      background-color: #0a6eff;
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tabs {
      margin: 20px;
    }
    .role-tabs button {
      border: 1px solid #ddd;
      padding: 8px 16px;
      margin-right: 5px;
      border-radius: 5px;
      background-color: white;
      cursor: pointer;
    }
    .role-tabs button.active {
      border: 1px solid #0a6eff;
      color: #0a6eff;
    }
    .tab-menu {
      margin-top: 20px;
    }
    .tab-menu button {
      background: none;
      border: none;
      font-weight: bold;
      margin-right: 20px;
      cursor: pointer;
      color: #0a6eff;
    }
    .table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
    }
    .table th, .table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    #connectBtn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .section {
      margin: 20px;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div><strong>Gov Budget Tracker</strong></div>
    <button id="connectBtn">Connect Wallet</button>
  </div>

  <div class="tabs">
    <div class="role-tabs">
      <button class="active">Central</button>
      <button>Department</button>
      <button>Validator</button>
    </div>

    <div class="tab-menu">
      <button>Departments</button>
      <button>Allocate Funds</button>
      <button>Deploy Department Branch</button>
    </div>
  </div>

  <div class="section">
    <h3>Departments</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Department ID</th>
          <th>Name</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="departmentsTable">
        <!-- Dynamic Rows -->
      </tbody>
    </table>
  </div>

  <div class="section">
    <h3>All Fund Allocation Transactions (Real-time)</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Sender</th>
          <th>Receiver (DeptID)</th>
          <th>Amount (ETH)</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody id="transactionsTable">
        <!-- Dynamic Transactions -->
      </tbody>
    </table>
  </div>

  <script>
    let web3;
    let contract;
    let account;

    const contractAddress = "0x882e81b3278BAfcF446DfA24a3A8577b07fB7dE9"; // Replace with your contract
    const contractABI = [[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "allocateBudget",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "remainingAmount",
				"type": "uint256"
			}
		],
		"name": "AuditPerformed",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "BudgetAllocated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "FundsSpent",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "spendFunds",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "deptId",
				"type": "string"
			}
		],
		"name": "auditBudget",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "remaining",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "budgets",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "allocatedAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "spentAmount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]]; // Add ABI here

    document.getElementById("connectBtn").onclick = async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.enable();
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        document.getElementById("connectBtn").innerText = account.slice(0, 6) + '...' + account.slice(-4);
        contract = new web3.eth.Contract(contractABI, contractAddress);
        console.log("Connected account:", account);
        // You can call fetch functions here
      } else {
        alert("Please install MetaMask");
      }
    };

    // Add logic to dynamically populate department and transaction tables
    // Example function placeholders:
    /*
    async function loadDepartments() {
      const data = await contract.methods.getDepartments().call();
      const table = document.getElementById("departmentsTable");
      table.innerHTML = "";
      data.forEach(dept => {
        table.innerHTML += `<tr><td>${dept.id}</td><td>${dept.name}</td><td>${web3.utils.fromWei(dept.balance, "ether")}</td></tr>`;
      });
    }
    
    async function loadTransactions() {
      const txs = await contract.getPastEvents('FundsAllocated', { fromBlock: 0, toBlock: 'latest' });
      const table = document.getElementById("transactionsTable");
      table.innerHTML = "";
      txs.forEach(tx => {
        const { sender, receiver, amount, timestamp } = tx.returnValues;
        table.innerHTML += `<tr>
          <td>${sender}</td>
          <td>${receiver}</td>
          <td>${web3.utils.fromWei(amount, 'ether')}</td>
          <td>${new Date(timestamp * 1000).toLocaleString()}</td>
        </tr>`;
      });
    }
    */
  </script>
</body>
</html>
